<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Midpoint Finder</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.min.css" />
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        #map {
            height: 400px;
            margin-top: 20px;
        }
        input, button {
            margin: 10px 0;
            padding: 5px;
        }
        #result {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>SweetSpot Finder</h1>
    <div>
        <input type="text" id="city1" placeholder="Enter first city">
        <input type="text" id="city2" placeholder="Enter second city">
        <button onclick="findMidpoint()">Find best location to meet</button>
    </div>
    <div id="map"></div>
    <div id="result"></div>

    <script>
        let map;
        let markers = [];

        function initMap() {
            map = L.map('map').setView([0, 0], 2);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: 'Â© OpenStreetMap contributors'
            }).addTo(map);
        }

        async function geocode(city) {
            const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(city)}`);
            const data = await response.json();
            if (data.length > 0) {
                return { lat: parseFloat(data[0].lat), lon: parseFloat(data[0].lon) };
            }
            throw new Error(`Could not find coordinates for ${city}`);
        }

        function midpoint(lat1, lon1, lat2, lon2) {
            const dLon = (lon2 - lon1) * Math.PI / 180;
            lat1 = lat1 * Math.PI / 180;
            lat2 = lat2 * Math.PI / 180;
            lon1 = lon1 * Math.PI / 180;

            const Bx = Math.cos(lat2) * Math.cos(dLon);
            const By = Math.cos(lat2) * Math.sin(dLon);
            const lat3 = Math.atan2(Math.sin(lat1) + Math.sin(lat2),
                Math.sqrt((Math.cos(lat1) + Bx) * (Math.cos(lat1) + Bx) + By * By));
            const lon3 = lon1 + Math.atan2(By, Math.cos(lat1) + Bx);

            return { lat: lat3 * 180 / Math.PI, lon: lon3 * 180 / Math.PI };
        }

        async function findMidpoint() {
            const city1 = document.getElementById('city1').value;
            const city2 = document.getElementById('city2').value;

            try {
                const coords1 = await geocode(city1);
                const coords2 = await geocode(city2);
                const mid = midpoint(coords1.lat, coords1.lon, coords2.lat, coords2.lon);

                // Clear previous markers
                markers.forEach(marker => map.removeLayer(marker));
                markers = [];

                // Add markers for cities and midpoint
                markers.push(L.marker([coords1.lat, coords1.lon]).addTo(map).bindPopup(city1));
                markers.push(L.marker([coords2.lat, coords2.lon]).addTo(map).bindPopup(city2));
                markers.push(L.marker([mid.lat, mid.lon]).addTo(map).bindPopup('Midpoint'));

                // Fit map to show all markers
                const group = new L.featureGroup(markers);
                map.fitBounds(group.getBounds().pad(0.1));

                // Display result
                document.getElementById('result').innerHTML = `
                    <h2>Results:</h2>
                    <p>${city1}: ${coords1.lat.toFixed(4)}, ${coords1.lon.toFixed(4)}</p>
                    <p>${city2}: ${coords2.lat.toFixed(4)}, ${coords2.lon.toFixed(4)}</p>
                    <p>Midpoint: ${mid.lat.toFixed(4)}, ${mid.lon.toFixed(4)}</p>
                `;
            } catch (error) {
                alert(error.message);
            }
        }

        initMap();
    </script>
</body>
</html>
